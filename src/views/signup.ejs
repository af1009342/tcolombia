<%- layout('layouts/main') %>

<!-- Modal -->
<div class="modal fade" id="contractModal" tabindex="-1" role="dialog" aria-labelledby="contractModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="contractModalLabel">Crear Contrato</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div class="row">
            <form id="for_modal" action="/data/contract" method="POST">
              <h4 class="text-center">Datos Coordinador</h4>
              <div class="form-group">
                <input type="text" id="email_mod" name="email_mod" placeholder="email del Coordinador" class="form-control" disabled>
              </div>
              <div class="form-group">
                <input type="text" id="codcontract" name="codcontract" placeholder="Código del Contrato" class="form-control" disabled>
                <input type="text" id="codcontract_id" name="codcontract_id" placeholder="Código del Contrato" class="form-control" disabled>
              </div>
              <div class="form-group"> 
                <input type="text" id="valor_mod" name="valor_mod" placeholder="valor contrato" class="form-control" pattern="[0-9]*">
              </div>
              <h4 class="text-center">Datos Cliente</h4> 
              <div class="form-group">
                <div class="row">
                    <div class="col-md-12 text-center ">
                    <div class="form-group"> 
                        <input type="text" id="name_client" name="name_client" placeholder="Cliente" class="form-control">
                      </div>
                      <div class="form-group">
                        <input type="text" id="dir_client" name="dir_client" placeholder="Dirección Cliente" class="form-control">
                      </div>
                      <div class="form-group">
                        <input type="tel" id="tel_client" name="tel_client" placeholder="Teléfono Cliente" class="form-control">
                      </div>       
                    </div> 

                  <div class="col-md-12 text-center ">
                    <input type="number" id="nit_cc_client" name="nit_cc_client" placeholder="Nit o Cedula" class="form-control">
                    <div class="btn-group" role="group" aria-label="...">
                      <button type="button" id="search_nit" class="btn btn-warning">Buscar <span
                          class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                      <button type="button" id="asign_nit" class="btn btn-success">Asginar <span
                          class="glyphicon glyphicon-check" aria-hidden="true"></span></button>
                          <div class="btn-group" role="group" aria-label="...">
                              <button type="button" class="btn btn-danger" id="made_client"
                                data-loading-text="<i class='fa fa-spinner fa-spin '></i>Creando Cliente...">
                                Crear Cliente<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                              </button>
                            </div> 
                    </div>
                  </div>
                </div>
              </div>


<!--               <div class="form-group">
                <div class="row">
                  <div class="col-md-12 text-center ">                    
                    <div class="btn-group" role="group" aria-label="...">
                      <button type="button" class="btn btn-danger" id="made_client"
                        data-loading-text="<i class='fa fa-spinner fa-spin '></i>Creando Cliente...">
                        Crear Cliente<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                      </button>
                    </div>
                  </div>
                </div>
              </div> -->

<!--             </form>
          </div>
 -->
          <h4 class="text-center">Datos Ficha</h4>
          <div class="row">
          <div class="col-md-4 text-center ">
          <div class="form-group">
            <input type="text" name="tab" placeholder="Codigo de primera Ficha" class="form-control"
              value="General">
          </div>
        </div>
        <div class="col-md-4 text-center ">
            <div class="form-group">
              <input type="text" name="Dependencia" placeholder="Dependencia para la primera Ficha" class="form-control"
                value="">
            </div>
          </div>
          <div class="col-md-4 text-center ">
              <div class="form-group">
                <input type="text" id="valor_ficha_mod" name="valor_ficha_mod" placeholder="Valor para la Ficha" class="form-control" pattern="[0-9]*">
              </div>
            </div> 
      </div>  
          </div>
          <button id="button_table"> llenar tabla</button>
          <div class="row">        
              <div class="col-md-12">
                  <table
                  id="table_tabs"
                  data-toggle="table_tabs"                 
                  data-minimum-count-columns="2"
                  data-id-field="id"
                  data-response-handler="responseHandler"        
                  class="table table-bordered table-hover">
               <thead>    
                <tr>
                  <th data-field="_id">Operaciones</th>
                  <th data-field="tab">Nombre Ficha</th>
                  <th data-field="Dependencia">Dependencia</th>          
                  <th data-field="valor_ficha">valor ficha</th>
                  <th data-field="valor_ficha_ejecutado">Valor Ejecutado</th>
                  <th data-field="contract" hidden>Valor Ejecutado</th>        
                </tr>
              </thead>
            </table>
          </div>        
        </div>
        <br>
        <br>
        <br>
        <br>
          <button id="main_crea_contr" type="submit" class="btn btn-primary mt-4 btn-block">
              Crear Contrato
            </button>
<!--                 <button type="submit" class="btn btn-danger mt-4 btn-block" id="made_contract"
                  data-loading-text="<i class='fa fa-spinner fa-spin '></i>Creando Cliente...">
                  Crear Contrato<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                </button> -->

          <!--   <div class="btn-group" role="group" aria-label="...">
                <button type="button" class="btn btn-danger mt-4 btn-block" id="made_contract"
                  data-loading-text="<i class='fa fa-spinner fa-spin '></i>Creando Cliente...">
                  Crear Contrato<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                </button>
              </div>  -->
          </form>

        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar|Close</button>
        <button type="button" class="btn btn-primary">Save changes|Guardar</button>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-4 col-md-offset-4">
    <div class="card mt-4 text-center">
      <div class="card mt-4 text-center">
        <div class="car-header">
          <h3>SignUp - Registrar Usuario</h3>
        </div>
        <div class="card-body">
          <form id="for_user" action="/signup" method="POST">
            <div class="form-group">
              <select name="role" id="selectionrole" class="form-control">
                <option value="admin">Administrador</option>
                <option value="coord" selected>Coordinador</option>
                <option value="oper">Operador</option>
                <option value="motor" selected>Motorista</option>
              </select>
            </div>
            <div class="form-group">
              <input type="text" id="name_user" name="name_user" placeholder="Nombre Usuario" class="form-control" value="nombre prueba">
            </div>            
            <div class="form-group">
              <input type="email" id="email" name="email" placeholder="Email" class="form-control"><!--  value="prueba@gmail.com"> -->
            </div>
            <div class="form-group">
              <input type="password" id="password" name="password" placeholder="Password" class="form-control" value="123456">
            </div>
            <div class="form-group">
              <input type="password" id="password_again" name="password_again" placeholder="Password"
                class="form-control" value="">
            </div>
            <div class="form-group">
              <div class="row">
                <div class="col-md-12">
                  <input type="text" id="codcontract_user" name="codcontract_user" placeholder="Buscar Contrato"
                    class="form-control" autocomplete="off"><!--  value="CG-XXX555"> -->
                    <div id="demo"></div>
                  <div class="btn-group" role="group" aria-label="...">
                    <button type="button" id="search_contract" class="btn btn-warning">Buscar <span
                        class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                      <button type="button" id="asign_contract" class="btn btn-success">Asignar <span
                        class="glyphicon glyphicon-check" aria-hidden="true"></span></button> 
                    <button type="submit" id="make_contract" class="btn btn-danger">Crear <span
                        class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span></button>
                  </div>
                </div>
              </div>
            </div>
        </div>
        <button id="reg_user" type="submit" class="btn btn-primary mt-4 btn-block">
          SignUp | Reg. Usuario
        </button>
        
        </form>
      </div>
    </div>
  </div>
  </form>

  
<!--  <div id="toolbar">
  <button id="button" class="btn btn-secondary">prepend</button>
</div>
<table
  id="table"
  data-toggle="table"
  data-toolbar="#toolbar"
  data-height="460"
  data-url="json/data1.json">
  <thead>
    <tr>
      <th data-field="id">ID</th>
      <th data-field="name">Item Name</th>
      <th data-field="price">Item Price</th>
    </tr>
  </thead>
</table> -->

<script>
  //nit_cc_client
  //sel_nit_cc
  $(document).ready(function(){
    
    var can_create_client = false;
    document.getElementById("asign_nit").disabled = true;  
    document.getElementById("made_client").disabled = true;

    //search_nit xxx

    $('#codcontract_user').on('input', function(){
    console.log("keyup, se bloquea la creación de usuarios");
    can_make_contrac= true;
    });


        $('#nit_cc_client').keyup(function(){
          var nit_cc_client_val = $(this).val();
          if(nit_cc_client_val.length > 3){
            //console.log(query);          
              $.getJSON( "/data/admin/client/"+nit_cc_client_val,{})
                  .done(function( data, textStatus, jqXHR ) {
                   /* var output = '<ul class="list-unstyled">';
                      console.log(data.selcontract.length);
                      console.log(data.selcontract);
                  if(data.selcontract.length>0){
                    
                  if ( console && console.log ) {
                      console.log( "La solicitud se ha completado correctamente." );
                     // console.log(data)
                      //console.log(data.selcontract[1].cliente.name_client);
                      
                      $.each(data.selcontract, function(i, val){ 
                          output +='<li id='+val._id+'>'+val.Codcontract+'/'+val.cliente.name_client+'</li>';
                      });
                      output += '</ul>';
                      $('#sel_contract').fadeIn();  
                      $('#sel_contract').html(output);  
                      
                  }
                }else{
                  output += '<li>Contrato No encontrado</li>';
                  output += '</ul>';
                  $('#sel_contract').html(output);
                  $('#sel_contract').fadeOut();
                }
                */
              })
              .fail(function( jqXHR, textStatus, errorThrown ) {
                  if ( console && console.log ) {
                      console.log( "Algo ha fallado: " +  textStatus);
                  }
              });
  
  
  
            }
          });	//fin ide unico
  
/*           $(document).on('click', 'li', function(){
            var arrayDeCadenas = $(this).text().split('/');  
             $('#nit_cc_client').val(arrayDeCadenas[0]);  
             $('#sel_nit_cc').fadeOut();  
        });   */
  
        });  
  
  </script>

<script>
$(document).ready(function(){


      });  
</script>
<script>

  
$('#made_contract').on('click', function () {
    var $this = $('#made_contract');
    $this.button('loading');

    if($("#form_modal").valid()){
      console.log('ya esta validado');
    }

    setTimeout(function () {
      $this.button('reset'); 
      $("#made_contract").addClass('btn-success').data('loading-text', 'Contrato Creado').button('loading')
    }, 1000);
  });


  $('#made_client').on('click', function () {
    var $this = $(this);
    $this.button('loading');

    var name_client =         document.getElementById('name_client').value; 
    var cod_contract_selec =  document.getElementById('codcontract').value;
    var dir_client =          document.getElementById('dir_client').value;
    var tel_client =          document.getElementById('tel_client').value;
    var nit_cc_client =       document.getElementById('nit_cc_client').value;

    var data_save = '&name_client=' + name_client + '&codcontract=' + cod_contract_selec + 
                    '&dir_client=' + dir_client + '&tel_client=' + tel_client+ '&nit_cc_client=' + nit_cc_client;
    $.ajax({
                url: '/admin/client/add', // url where to submit the request
                type : "POST", // type of action POST || GET
                dataType : 'json', // data type
                data : data_save, // post data || get data
                success : function(result) {
                    // you can see the result from the console
                    // tab of the developer tools
                    console.log(result.client);
                    if (result.client._id.length>23){
                      console.log("mas que 0");

                      document.getElementById('name_client').value = result.client.name_client; 
                      //document.getElementById('codcontract').value = result.client.codcontract;
                      document.getElementById('dir_client').value  = result.client.dir_client;
                      document.getElementById('tel_client').value = result.client.tel_client;
                      document.getElementById('nit_cc_client').value = result.client.nit_cc_client;
                    }                    
                    //$("#made_client").attr("disabled", true);
                    
                },
                error: function(xhr, resp, text) {
                    console.log(xhr, resp, text);
                }
            })


    setTimeout(function () {
      $this.button('reset'); 
      $("#made_client").addClass('btn-success').data('loading-text', 'Cliente Creado').button('loading')
    }, 1000);
  });


</script>

<script>
 
</script>



  <script>
  
  $(document).ready(function () {    

  var can_make_contrac = false;
  document.getElementById("asign_contract").disabled = true;  
  document.getElementById("make_contract").disabled = true;
  
  
  $('#asign_contract').click(function () {      
      console.log("asign_contract");
      if ($("#for_user").valid()){
        //------------- 
        var data_save = $(for_user).serialize();
          console.log("try Submit for_user: "+data_save);    
        
            $.ajax({
                        url: '/admin/signup/', // url where to submit the request
                        type : "POST", // type of action POST || GET
                        dataType : 'json', // data type
                        data : data_save, // post data || get data
                        success : function(result, message) {
                            // you can see the result from the console
                            // tab of the developer tools
                            
                            console.log(result);
                            console.log(message);
                            window.location.reload();
                        },
                        error: function(xhr, resp, text) {
                          console.log("error");
                            console.log(xhr, resp, text);
                        }
                    });
       
                  }
        //---------------


  });

  $('#search_contract').click(function () {
    var can_make_contrac = false;
    document.getElementById("asign_contract").disabled = true;  
    document.getElementById("make_contract").disabled = true;

      var codcontract_user =         document.getElementById('codcontract_user').value;                
            if(codcontract_user.length > 3){
                        
              console.log("search_contract");
            $.getJSON( "/data/admin/contract/"+codcontract_user,{})
            .done(function( data, textStatus, jqXHR ) {
              var output = '<ul class="list-unstyled">';
                console.log(data.selcontract.length+" status "+jqXHR.status);
                console.log(data.selcontract);
            if(data.selcontract.length>0){
              console.log( "click, La solicitud se ha completado correctamente con resultados.");                  
            if ( console && console.log ) {
                console.log( "click, La solicitud se ha completado correctamente.");
               // console.log(data)
                //console.log(data.selcontract[1].cliente.name_client);                    
                $.each(data.selcontract, function(i, val){ 
                    output +='<li id='+val._id+'>'+val.Codcontract+'</li>';
                    /* output +='<li id='+val._id+'>'+val.Codcontract+'/'+val.cliente.name_client+'</li>'; */
                });
                output += '</ul>';
                $('#demo').fadeIn();  
                $('#demo').delay(500).fadeTo("slow", 0.6);  
                //$('#demo').html(output);  
                document.getElementById("demo").innerHTML = output;
            }
          }else{
            console.log( "click, La solicitud se ha completado sin resultados." );
            output += '<li>Contrato No encontrado</li>';
            output += '</ul>';
            $('#demo').html(output);
            $('#demo').delay(500).fadeTo("slow", 0.6);  
                //$('#demo').html(output);  
            document.getElementById("demo").innerHTML = output;
            can_make_contrac= true;

            document.getElementById("asign_contract").disabled = true;
            document.getElementById("make_contract").disabled = false;
            document.getElementById("reg_user").disabled = true;
            
          }
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
            if ( console && console.log ) {
                console.log( "Algo ha fallado: " +  textStatus);
            }
        });
      
      }    
});

$('#codcontract_user').on('input', function(){
    console.log("keyup, se bloquea la creación de usuarios");
    can_make_contrac= true;
});


  $('#codcontract_user').keyup(function(){
    var codcontract_user = $(this).val();
    
    if(codcontract_user.length > 5){
      //console.log(query);
      document.getElementById("make_contract").disabled = false;
      document.getElementById("asign_contract").disabled = true;

        $.getJSON( "/data/admin/contract/"+codcontract_user,{})
            .done(function( data, textStatus, jqXHR ) {
              var output = '<ul class="list-unstyled">';
                console.log(data.selcontract.length);
                console.log(data.selcontract);
            if(data.selcontract.length>0){                  
            if ( console && console.log ) {
                console.log( "keyup, La solicitud se ha completado correctamente, con resultados." );
               // console.log(data)
                //console.log(data.selcontract[1].cliente.name_client);                    
                $.each(data.selcontract, function(i, val){ 
                    /* output +='<li id='+val._id+'>'+val.Codcontract+'/'+val.cliente.name_client+'</li>'; */
                    output +='<li id='+val._id+'>'+val.Codcontract+'</li>';
                });
                output += '</ul>';
                $('#demo').delay(500).fadeTo("slow", 0.6);  
                //$('#demo').html(output);  
                document.getElementById("demo").innerHTML = output;
            }
          }else{
            console.log( "keyup, La solicitud se ha completado sin resultados." );
            output += '<li>Contrato No encontrado</li>';
            output += '</ul>';
            document.getElementById("demo").innerHTML = output;
            //$('#demo').html(output);
            $('#demo').delay(500).fadeTo("slow", 0.6);
            can_make_contrac= true;
            document.getElementById("asign_contract").disabled = true;
            //document.getElementById("make_contract").disabled = false;
            document.getElementById("reg_user").disabled = true;
          }
        })
        .fail(function( jqXHR, textStatus, errorThrown ) {
            if ( console && console.log ) {
                console.log( "Algo ha fallado: " +  textStatus);
            }
        });
      }
    });	//fin ide unico

    $(document).on('click', 'li', function(){
      var arrayDeCadenas = $(this).text().split('/');  
       $('#codcontract_user').val(arrayDeCadenas[0]);  
       $('#demo').fadeOut();
       can_make_contrac= false;
       document.getElementById("asign_contract").disabled = false;
       document.getElementById("make_contract").disabled = true;
       document.getElementById("reg_user").disabled = false;  
    });  

    //----------------

    
    //format type currency
/*     document.getElementById("valor_mod").onblur =function (){    

      this.value = parseFloat(this.value.replace(/,/g, ""))
                    .toFixed(2)
                    .toString()
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }         


    document.getElementById("valor_ficha_mod").onblur =function (){    

      this.value = parseFloat(this.value.replace(/,/g, ""))
                    .toFixed(2)
                    .toString()
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }    */      

    var resul_modal_id = "";

    $.validator.setDefaults({   
    // added submitHandler only for demo
    submitHandler: function(form) { 
    //return false; 
    //add validation process for a form submited
        //for user validation 
        if (form.id=="for_user"){
          //name_user
          
              var selectionrole = document.getElementById('selectionrole').value;
              var codcontract_user = document.getElementById('codcontract_user').value;
              console.log("try Submit for_user "+codcontract_user+" can_make_contrac "+ can_make_contrac);
              if (selectionrole == "coord") {
              if (can_make_contrac) {
                  if (confirm('Seleccionaste: Crear el Nuevo contrato ' + codcontract_user + ', es correcto ?')) {                
                  document.getElementById('codcontract').value= codcontract_user;
                  var email_selec = document.getElementById('email').value;
                  document.getElementById('email_mod').value = email_selec;
                  console.log("Carga Modal");
                  $("#contractModal").modal()
                }
              }else{
                    form.submit();
                    console.log("submit");
              }
            }
        }
        //modal validation 
        if (form.id=="for_modal"){
          var email_selec       = document.getElementById('email').value;
          var codcontract_selec = document.getElementById('codcontract').value;          
          var valor_ficha_str       = document.getElementById('valor_ficha_mod').value;    
          var valor_str             = document.getElementById('valor_mod').value;

          var valor = valor_str.replace(/,/g, "");
          var valor_ficha = valor_ficha_str.replace(/,/g, "");

          var data_save = $(form).serialize()+"&email="+email_selec+"&Codcontract="+
                          codcontract_selec+"&valor_ficha="+valor_ficha+"&valor="+valor;
          console.log("try Submit for_modal: "+data_save);          
          $.ajax({
                        url: '/admin/contract/add', // url where to submit the request
                        type : "POST", // type of action POST || GET
                        dataType : 'json', // data type
                        data : data_save, // post data || get data
                        success : function(result) {
                            // you can see the result from the console
                            // tab of the developer tools
                            console.log(result.contract_id);
                                                       
                            document.getElementById("codcontract_id").value= result.contract_id;
                            //bloqueo campos
                            document.getElementById("codcontract").disabled = true;
                            document.getElementById("valor_mod").disabled = true;
                            document.getElementById("name_client").disabled = true;
                            document.getElementById("dir_client").disabled = true;
                            document.getElementById("tel_client").disabled = true;
                            document.getElementById("nit_cc_client").disabled = true;

                            document.getElementById("search_nit").disabled = true;
                            document.getElementById("asign_nit").disabled = true;
                            document.getElementById("made_client").disabled = true;
                            document.getElementById("main_crea_contr").disabled = true;
                            
                            
                        },
                        error: function(xhr, resp, text) {
                            console.log(xhr, resp, text);
                        }
                    });

        }

    }
});


/* 
// init validator obj and set the rules
$('#formB').validate({
    rules: {
        name2: {
            required: true
        }
    }
}); */

   // validate signup form on keyup and submit         
   $('#for_modal').validate({
        rules: {
          //contrato y ficha quedan pendientes    
          valor_mod: { 
            required: true,
            minlength: 3
          },
          email_mod: {
            required: true,
            email_mod: true
          },
          codcontract: {
            required: true,
            minlength: 3
          },
          name_client: {
            required: true,
            minlength: 5
          },        
          dir_client: {
            required: true,
            minlength: 5
          },
          tel_client: {
            required: true,
            minlength: 7
          },
          tab: {
            required: true,
            minlength: 5
          },
          Dependencia: {
            required: true,
            minlength: 5
          },
          valor_ficha_mod: {   
            required: true,
            minlength: 3
          },
          nit_cc_client: {
            required: true,
            minlength: 5
          }          
        },  
        messages: {
          valor_mod: {
            required: "Por favor ingrese un Valor para el Contrato",
            minlength: "Ingrese un valor de ficha de contrato de mas de 3 cifras"
          },
          name_client: {
            required: "Por favor ingrese  nombre del cliente que toma el contrato",
            minlength: "el nombre del cliente debe tener por lo menos 5 caracteres"
          },
          dir_client: {
            required: "Por favor ingrese una dirección para el cliente del contrato",
            minlength: "Por favor ingrese una dirección correcta para el cliente del contrato",
          },
          tel_client: {
            required: "Por favor ingrese un teléfono fijo o celular para el cliente del contrato",
            minlength: "Por favor ingrese un teléfono fijo o celular correcta para el cliente del contrato",
          },
          nit_cc_client: {
            required: "Por favor ingrese el NIt o Cedula para el cliente del contrato",
            minlength: "Por favor ingrese el NIt o Cedula correcta para el cliente del contrato",
          },
          tab: {
            required: "Por favor ingrese un nombre o código para la primera ficha del contrato",
            minlength: "Por favor ingrese un nombre o código para la primera ficha del contrato, con mas de 5 caracteres",
          },
          Dependencia: {
            required: "Por favor ingrese el nombre de la Dependencia para la ficha del contrato",
            minlength: "Por favor ingrese el nombre de la Dependencia para la ficha del contrato, con mas de 5 caracteres",
          },
          valor_ficha_mod: {
            required: "Por favor ingrese el valor de la ficha asignada a la Dependencia",
            minlength: "Por favor ingrese el valor de la ficha asignada a la  Dependencia , con mínimo de 3 cifras",
          },
          codcontract: {
            required: "Ingrese un código para identificar el contrato de transporte",
            minlength: "Ingrese un código de contrato Valido minimo 3 caracteres"
          },
          email_mod: "Por Favor ingrese una dirección email valida"
        }

        });

 // validate signup form on keyup and submit          
 $('#for_user').validate({
      rules: {
        //contrato y ficha quedan pendientes    
        role: {
          required: true
        },
        name_user:{
          required: true,
          minlength: 5
        },
        email: {
          required: true,
          email: true
        },
        password: {
          required: true,
          minlength: 5
        },
        password_again: {
          equalTo: "#password"
        },
        codcontract_user: {
          required: true,
          minlength: 5
        }
      },

      messages: {
        role: {
          required: "Por favor seleciones un Role para el Usuario."
        },
        name_user: {
          required: "Por favor Ingrese nombre del Usuario.",
          minlength: "el nombre de usuario debe tener por lo menos 5 caracteres"
        },
        password: {
          required: "Por favor ingrese  password temporal para el usuario",
          minlength: "el password debe tener por lo menos 5 números"
        },
        password_again: {
          equalTo: "Por favor repita el password temporal para el usuario"
        },
        codcontract_user: {
          required: "Ingrese un código para identificar el contrato de transporte",
          minlength: "Ingrese un código de contrato Valido números y letras son permitidos"
        },
        email: "Por Favor ingrese una dirección email valida"
      }
    });

});



/*   var $table = $('#table_tabs');
  

  function randomData() {
    var startId = ~~(Math.random() * 100)
    var rows = [];
    rows = datax;

    for (var i = 0; i < 5; i++) {
      rows.push({
        id: startId + i,
        contract: 'contract' + (startId + i),
        cod_tab: 'Nombre Ficha' + (startId + i),
        Dependencia: 'Encuesta hogar' + (startId + i),
        valor_ficha: '$' + (startId + i),
        valor_ficha_ejecutado: '-$' + (startId + i)
      })
    }
    return rows
  }

  
    $button.click(function () {
      var resul_modal_id = document.getElementById("codcontract_id").value;     
       //alert(resul_modal_id);
      $.getJSON( "/data/contract/"+resul_modal_id,{})
    .done(function( data, textStatus, jqXHR ) {
        if ( console && console.log ) {
            console.log( "La solicitud se ha completado correctamente...." );
            console.log(data);

            $table.bootstrapTable('prepend', data);
        }
    })
    .fail(function( jqXHR, textStatus, errorThrown ) {
        if ( console && console.log ) {
            console.log( "Algo ha fallado: " +  textStatus);
        }
    });
      
      
      
      //$table.bootstrapTable('prepend', randomData());


      
    })
  
*/
  var datax = [ 
    {
      "id": 0,
      "contract": "CG-0426",
      "cod_tab": "00021",
      "Dependencia": "DANE Encuesta Hogar",
      "valor_ficha": 100000000,
      "valor_ficha_ejecutado": -8000000,
    },
    {
      "id": 1,      
      "contract": "CG-0426",
      "cod_tab": "00021",
      "Dependencia": "DANE Encuesta Hogar",
      "valor_ficha": 100000000,
      "valor_ficha_ejecutado": -8000000,
    },
    {
      "id": 2,
      "contract": "CG-0426",
      "cod_tab": "00021",
      "Dependencia": "DANE Encuesta Hogar",
      "valor_ficha": 100000000,
      "valor_ficha_ejecutado": -8000000,
    },
    {
      "id": 3,
      "contract": "CG-0426",
      "cod_tab": "00021",
      "Dependencia": "DANE Encuesta Hogar",
      "valor_ficha": 100000000,
      "valor_ficha_ejecutado": -8000000,
    },
    {
      "id": 4,
      "contract": "CG-0426",
      "cod_tab": "00021",
      "Dependencia": "DANE Encuesta Hogar",
      "valor_ficha": 100000000,
      "valor_ficha_ejecutado": -8000000,
    },
    {
      "id": 5,
      "contract": "CG-0426",
      "cod_tab": "00021",
      "Dependencia": "DANE Encuesta Hogar",
      "valor_ficha": 100000000,
      "valor_ficha_ejecutado": -8000000,
    }
  ];
  
  </script>

  
<script>
     //var $table = $('#tablex');
     var $button = $('#button_table');
$button.click(function () {
  initTable();
});
     var $table = $('#table_tabs');
     var $remove = $('#remove');
      
    
     var selections = []
                  
                    function getIdSelections() {
                      return $.map($table.bootstrapTable('getSelections'), function (row) {
                        return row.id
                      })
                    }
                  
                    function responseHandler(res) {
                      $.each(res.rows, function (i, row) {
                        row.state = $.inArray(row.id, selections) !== -1
                      })
                      return res
                    }
                  
                    function detailFormatter(index, row) {
                      var html = []
                      $.each(row, function (key, value) {
                        html.push('<p><b>' + key + ':</b> ' + value + '</p>')
                      })
                      return html.join('')
                    }
                  
                    function operateFormatter(value, row, index) {
                      return [
                        '<a class="remove" href="javascript:void(0)" title="Remove">',
                        '<i class="fa fa-trash"></i>',
                        '</a>'
                      ].join('')
                    }
                  
                    window.operateEvents = {                  
                      'click .remove': function (e, value, row, index) {              
                        if(confirm("Esta seguro de que quiere eliminar este servicio.?"+row._id+" and contract " +row.contract)){
                          $.ajax({ 
                          url:"/admin/"+row.contract+"/"+row._id+"/remove", //'/admin/:contractId/:fichaId/remove'
                          method:"PUT",     
                          success:function(data){
                            console.log(data);
                          $table.bootstrapTable('refresh');
                          } 
                          });
                        }
                        
                      }
                    }
                    
                    function totalTextFormatter(data) {
                      return 'Total';
                    }
                  
                    function totalNameFormatter(data) {
                      return data.length;
                    }
                  
                    function totalPriceFormatter(data) {
                      var field = this.field;
                      return '$' + data.map(function (row) {
                        return +row[field].substring(1)
                      }).reduce(function (sum, i) {
                        return sum + i;
                      }, 0)
                    }
                  
                    function initTable() {
                      $table.bootstrapTable('destroy').bootstrapTable({
                        height: 150,
                        locale: 'es-ES',//$('#locale').val(),
                        columns: [
                          [{
                            field: 'state',
                            checkbox: false,
                            rowspan: 2,
                            align: 'center',
                            valign: 'middle',
                            events: window.operateEvents,
                            formatter: operateFormatter
                          }],
                          [{
                            field: 'tab',
                            //title: 'Codigo Ficha',
                            //sortable: true,
                            //footerFormatter: totalNameFormatter,
                            align: 'center'
                          }, {
                            field: 'Dependencia',
                            //title: 'Dependencia..',
                            //sortable: true,
                            align: 'center',
                            //footerFormatter: totalPriceFormatter
                          }, {
                            field: 'valor_ficha',
                            //title: 'Item valor_ficha',
                            align: 'center'

                          }, {
                            field: 'valor_ficha_ejecutado',
                            //title: 'contract..',
                            //sortable: true,
                            align: 'center',
                            //footerFormatter: totalPriceFormatter
                          }]
                        ]
                      })
                      $table.on('check.bs.table uncheck.bs.table ' +
                        'check-all.bs.table uncheck-all.bs.table',
                      function () {
                        $remove.prop('disabled', !$table.bootstrapTable('getSelections').length);
                  
                        // save your data, here just save the current page
                        selections = getIdSelections();
                        // push or splice the selections if you want to save all data selections
                      })
                      $table.on('all.bs.table', function (e, name, args) {
                        console.log(name, args);
                      });
                      $remove.click(function () {
                        var ids = getIdSelections();
                        $table.bootstrapTable('remove', {
                          field: 'id',
                          values: ids
                        })
                        $remove.prop('disabled', true);
                      })
                    }
                  
                    $(function() {
                      initTable();

                      var resul_modal_id = document.getElementById("codcontract_id").value;     
                      //alert(resul_modal_id);
                      $.getJSON( "/data/contract/"+resul_modal_id,{})                     
                      
                          .done(function( data, textStatus, jqXHR ) {
                              if ( console && console.log ) {
                                  console.log( "La solicitud se ha completado correctamente .." );
                                  console.log(data);

                                  $table.bootstrapTable('prepend', data.ficha);
                              }
                          })
                          .fail(function( jqXHR, textStatus, errorThrown ) {
                              if ( console && console.log ) {
                                  console.log( "Algo ha fallado: " +  textStatus);
                              }
                      });
            
                    });
    
    </script>
